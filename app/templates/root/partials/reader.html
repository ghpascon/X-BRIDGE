<div class="card card-body">
  <!-- DEVICE -->
  <h1>{{ device }}</h1>

  {% if is_rfid_reader(device) %}
  <!-- BUTTONS -->
  <div style="padding: 0%" class="d-flex">
    <button
      onclick="fetch('{{ url_for('start_inventory', device=device) }}', { method: 'POST' })"
      class="btn btn-success"
    >
      Start
    </button>

    <button
      onclick="fetch('{{ url_for('stop_inventory', device=device) }}', { method: 'POST' })"
      class="btn btn-danger"
      style="margin-left: 15px"
    >
      Stop
    </button>

    <button
      onclick="fetch('{{ url_for('clear_tags', device=device) }}', { method: 'POST' })"
      class="btn btn-warning"
      style="margin-left: 15px"
    >
      Clear
    </button>

    <!-- GPO -->
    <button
      onclick="fetch('{{ url_for('set_gpo', device=device, gpo_pin=1, state='true', control='static', time=1000) }}', { method: 'POST' })"
      class="btn btn-success"
      style="margin-left: 15px"
    >
      GPO TRUE
    </button>
    <button
      onclick="fetch('{{ url_for('set_gpo', device=device, gpo_pin=1, state='false', control='static', time=1000) }}', { method: 'POST' })"
      class="btn btn-danger"
      style="margin-left: 15px"
    >
      GPO FALSE
    </button>
  </div>
  {% endif %}

  <!-- STATE -->
  <div
    class="d-flex align-items-center justify-content-between mb-3 gap-1 flex-wrap"
  >
    <h2 id="state_label_{{ device|replace(' ', '_') }}"></h2>
  </div>
</div>

<script>
  async function updateReadingState_{{ device|replace(' ', '_') }}() {
    try {
      const response = await fetch("{{ url_for('get_reader_state', device=device) }}");
      if (!response.ok) throw new Error("Request failed");

      const data = await response.json();

      let labelText = "";
      let btnClass = "btn-secondary"; // padr√£o

      switch (data.state) {
        case -1:
          labelText = "‚ùå Device not found";
          btnClass = "btn-danger";
          break;
        case 0:
          labelText = "‚ùå Disconnected";
          btnClass = "btn-danger";
          break;
        case 1:
          labelText = "‚úÖ Connected";
          btnClass = "btn-success";
          break;
        case 2:
          labelText = "üîç Reading tags";
          btnClass = "btn-warning";
          break;
        default:
          labelText = "‚ö†Ô∏è Unknown state";
          btnClass = "btn-secondary";
      }

      const label = document.getElementById("state_label_{{ device|replace(' ', '_') }}");
      const button = document.getElementById("toggle-btn-{{ device|replace(' ', '_') }}");

      label.innerText = labelText;

      // Remove classes de cor anteriores (modifique conforme as classes que voc√™ usa)
      button.classList.remove(
        "btn-primary",
        "btn-success",
        "btn-warning",
        "btn-danger",
        "btn-secondary"
      );
      // Adiciona a classe correta
      button.classList.add(btnClass);

    } catch (error) {
      console.error("Error fetching reader state:", error);
      document.getElementById("state_label_{{ device|replace(' ', '_') }}").innerText = "‚ö†Ô∏è Error";
    }
  }

        // Update every 500ms
        setInterval(updateReadingState_{{ device|replace(' ', '_') }}, 500);
        updateReadingState_{{ device|replace(' ', '_') }}();
</script>
